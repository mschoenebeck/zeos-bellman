#include <iostream>
#include <sstream>
#include <string>
#include <vector>

#include <json_struct.h>
#include "groth16/verifier.hpp"

// mint circuit
const char vk_str[] = "{\"alpha_g1\":{\"x\":{\"data\":[1547724834221454138,13089410747059938556,11232643936799136011,874960740878073402,322809695233442188,187655516727520334]},\"y\":{\"data\":[3607469513710049758,12541136678608009,7956544006311292072,10048336366952309745,29192195408958006,644825380817598802]},\"infinity\":{\"data\":0}},\"beta_g1\":{\"x\":{\"data\":[13289519629052594360,7311567589968526889,9011583075478963620,13978738583811679920,6880498891112227694,326618182801882021]},\"y\":{\"data\":[3182207160849406111,2145687836868136005,16166911400419798002,4745726248171051739,11809107657255144943,450846119113879458]},\"infinity\":{\"data\":0}},\"beta_g2\":{\"x\":{\"c0\":{\"data\":[12423369661715754340,8814909223331794599,7584030544780577032,9003368386498666444,660714104988691107,1221690770626298882]},\"c1\":{\"data\":[9363474780868547397,6047511251753935723,327703819220855411,9542569580583191227,6056471465838704674,1035109301213507182]}},\"y\":{\"c0\":{\"data\":[6948658506681302980,6002034887004175609,14872801028870342614,12685956698045921229,17074142670588612632,763432359788294667]},\"c1\":{\"data\":[16133395625168340002,8334405562853919114,167846219628063134,4277481659453572210,7307711655124392234,322852799850292594]}},\"infinity\":{\"data\":0}},\"gamma_g2\":{\"x\":{\"c0\":{\"data\":[1886041628313548769,8375358979283630434,12205586715809719554,16307193099833807885,7534747486812580466,109308073026988608]},\"c1\":{\"data\":[14657527580421724157,8378698784660249887,16708259998920943394,11206289191730312668,1763159233261611498,873478210097897305]}},\"y\":{\"c0\":{\"data\":[6238585417434838632,3530642841455591214,7156928798064255440,16137663914560721317,8427868427378756207,1550600913514215955]},\"c1\":{\"data\":[16907292290261877616,6203639835461874733,9954729168503505335,14711869002854954649,1893243896742504776,683469874415142430]}},\"infinity\":{\"data\":0}},\"delta_g1\":{\"x\":{\"data\":[3429185733304486686,10749172313462762146,9107641488884632924,1052685570878644804,14821800714802674684,1058315023829982121]},\"y\":{\"data\":[4767013330324957553,16043652088548012759,4527768376992489899,6804632086697169748,15035297286411709474,1029130095234950067]},\"infinity\":{\"data\":0}},\"delta_g2\":{\"x\":{\"c0\":{\"data\":[11771459989883502782,4553519585518321685,14297879089447207906,16469783884575130821,4182012672604359238,1513592880139516976]},\"c1\":{\"data\":[18027758234410956145,13826554872705544322,11505812406822724526,6554127690076230678,15819870792818472492,1402552654532807105]}},\"y\":{\"c0\":{\"data\":[4668299183596964576,3117076636654800913,17475159171013567523,1989832056461953659,2761481416575825640,182809177407980206]},\"c1\":{\"data\":[2519041749974068692,13315018081301973530,15138305638774733068,7303961772590279727,5041082628330162771,324066914935291880]}},\"infinity\":{\"data\":0}},\"ic\":[{\"x\":{\"data\":[5508653206934443525,14454927710886682379,1417500161345255038,15952011603241989817,16831810327889121083,1165301416656344586]},\"y\":{\"data\":[16423262907875533762,3907814107357750927,4111224767094125002,10951382061384718060,6321504236070004845,821667332929891741]},\"infinity\":{\"data\":0}},{\"x\":{\"data\":[6842254636136866196,1130982178661792716,4708058173891889846,12277168378069493718,18312448005124663461,8023144040552394]},\"y\":{\"data\":[2420264682440047033,5738946348447178591,3628565341817362763,11576084578547296024,6132606706733525610,1402848502974469865]},\"infinity\":{\"data\":0}},{\"x\":{\"data\":[12435579101616772725,1489828618142856288,15834524457128589695,18284924769808297435,17233433073412409853,581367886194467806]},\"y\":{\"data\":[9011852466009653601,12034845347688758744,4875029596845352343,2056039923237896449,15177237686252989477,256924557766942561]},\"infinity\":{\"data\":0}}]}";
const char proof_str[] = "{\"a\":{\"x\":{\"data\":[10812925357174879495,15438515848179381138,8453555797981981630,9712110959158019974,8385388966990731754,934663084055189813]},\"y\":{\"data\":[14435236148633587734,13308853024788392896,5512846645493652804,9877147538370023527,13707627422669957466,1126945759540753620]},\"infinity\":{\"data\":0}},\"b\":{\"x\":{\"c0\":{\"data\":[7911250306683765731,1649765083200323360,7853402294069894517,1249178627963750656,9468677482875349803,1138600167610627436]},\"c1\":{\"data\":[13286319900210696705,8517864781376594808,2233911802390498951,17334015652923551316,12190669667178429978,386628897980741802]}},\"y\":{\"c0\":{\"data\":[7717144018768143673,11624427629606858724,7559239864461484017,4845138691788727642,12458471566995571999,946291130411235400]},\"c1\":{\"data\":[8736409989937600006,10451679509212293186,15048819477405389533,11337040789487014663,14348945050489163009,411092106062894313]}},\"infinity\":{\"data\":0}},\"c\":{\"x\":{\"data\":[10930510860437831002,3697502901153640963,11372284078242429310,14234585860443065946,7945932528201887836,372956223649827008]},\"y\":{\"data\":[10331728427925052104,17178109923481604666,2949512088952021646,4037100036457118718,7280531456884558455,233587659793003472]},\"infinity\":{\"data\":0}}}";
const char inputs_str[] = "[{\"data\":[8607175986312658769,16500865648227469575,17601667713438741575,4236797027743776442]},{\"data\":[13892806926176622008,5769902910267043290,5099996946623378437,1561571480680424352]}]";

// blake2s hash value
//const char vk_str[] = "{\"alpha_g1\":{\"x\":{\"data\":[10743384851791489833,16151200417142004433,3486072283009176738,2359704508242334157,4708476084099670530,117978659527193769]},\"y\":{\"data\":[13957980117130975030,5822048176370104852,1339558264020996111,1532176014662337896,8340395934102853712,1522755594305001437]},\"infinity\":{\"data\":0}},\"beta_g1\":{\"x\":{\"data\":[16336276466035058004,5655388751077479477,1679015989554504750,2623669155576461081,3935913039170219345,154166148320031076]},\"y\":{\"data\":[8644335105712336194,12131412578238388818,13121685135007799676,1181734283780229093,7508786078344332975,1626746759878785135]},\"infinity\":{\"data\":0}},\"beta_g2\":{\"x\":{\"c0\":{\"data\":[14683346903100073974,1666718837225419595,5633598055022532106,6513267455984322387,12696530528544167067,582756158093453604]},\"c1\":{\"data\":[3420528671943142140,14222245016971183456,2176882552115121043,8801619206015550765,8916460120321652234,173146702777656485]}},\"y\":{\"c0\":{\"data\":[5229810285136009575,10337769438408412402,6268270359993352066,4125159541573391480,779602930788866821,149090053613976319]},\"c1\":{\"data\":[2610480942531910736,5475195225999623490,11422087897356630362,14677561971768792069,10838708332151616781,1735190093784600374]}},\"infinity\":{\"data\":0}},\"gamma_g2\":{\"x\":{\"c0\":{\"data\":[2794433170180859567,7064600856466887598,12201975939530329049,9515626992149925907,18157212290257703914,1366911823468187920]},\"c1\":{\"data\":[3593013553623095578,8439735514307417609,11842281694234360018,12369263433056225414,8421145686768483154,716645400371106243]}},\"y\":{\"c0\":{\"data\":[8541385706149520710,9071235911008739966,18316841060326806620,15864212296116637958,11395887112706860157,1016488696475916781]},\"c1\":{\"data\":[12385799808150148137,12804087564757670396,2328128474431562616,6007774044674591807,12432565084585985708,951634616407578578]}},\"infinity\":{\"data\":0}},\"delta_g1\":{\"x\":{\"data\":[8627667892921027099,12165335264705416714,14374326914122215574,11448342927035616156,4075332379949178241,332106812812682765]},\"y\":{\"data\":[6110026689438337031,17562828516092098021,9803564303331538501,5776581761860589673,9962648949175825151,216877563980391245]},\"infinity\":{\"data\":0}},\"delta_g2\":{\"x\":{\"c0\":{\"data\":[18059653376801834460,4081407148092412111,6942955549908037155,10121673098419690888,16184483163751819094,1298142748417881665]},\"c1\":{\"data\":[9395251418400809222,5418837050998788981,524227774794659679,16868833676259445004,5263494482361274251,585646204315210087]}},\"y\":{\"c0\":{\"data\":[16739784735331559919,1648743447891671405,8846660640161867074,17732140527320760345,9938171135438388642,13490147628417654]},\"c1\":{\"data\":[10594112773914910438,15402869028253737547,15602805270476857782,1001640825967860647,11908682065912839655,458958534053967746]}},\"infinity\":{\"data\":0}},\"ic\":[{\"x\":{\"data\":[15346966027547093818,6411204378235976676,5234623727307616737,17680489148913946050,8936698622347372480,1003524326246725090]},\"y\":{\"data\":[454443256999861957,53440351173102560,9870679934901729919,18193802346729527754,11274054807968347382,658109242880508951]},\"infinity\":{\"data\":0}},{\"x\":{\"data\":[2660250119366267882,7344684222782227679,7359655539248956854,191157781886424297,14886754476477574807,736234593478700187]},\"y\":{\"data\":[2010863625819379920,4886564817472820955,3280047083358996279,4666658994511466890,17118581219092364687,1061308953101415749]},\"infinity\":{\"data\":0}},{\"x\":{\"data\":[10758570710829461064,11689881356114913902,2913550897319063237,7782348307822869276,216281277844080332,1125599416512488514]},\"y\":{\"data\":[1159011061255085614,12957425220883659835,7895363425667529718,11961224213543660359,5263886183803976470,1623618169521695125]},\"infinity\":{\"data\":0}}]}";
//const char proof_str[] = "{\"a\":{\"x\":{\"data\":[11281214743188095108,7324960852881245773,16323074521503261530,7935442180524566485,3447205503407154254,142696605983680825]},\"y\":{\"data\":[12959333984886701833,7557107698944420430,10229267066654835700,4267746412519327896,683852416278172248,685037468885050226]},\"infinity\":{\"data\":0}},\"b\":{\"x\":{\"c0\":{\"data\":[4489172262238247121,65327003249188103,9875490749400609176,9708019759866291059,13811407545776824185,605904864226976272]},\"c1\":{\"data\":[10857120443589108310,8117251748703107106,4071018462117451686,9539327385730157308,5187384769016239525,1229022557506643579]}},\"y\":{\"c0\":{\"data\":[12371344812501916242,13880608924742898686,12684360797548923548,7908539914859763307,747934384853808855,291739538199426247]},\"c1\":{\"data\":[8700430337445437660,2568693626588558167,12346231620464952391,10857595540458505831,2666845546159284308,354222503363084332]}},\"infinity\":{\"data\":0}},\"c\":{\"x\":{\"data\":[685179753558974742,18240946522920941153,8481567336493327996,5233494953992381856,5791281528757539263,1501267797956638369]},\"y\":{\"data\":[13024671334677689105,17824851971584033097,8770117755147595354,11381201407111114616,239678930193425203,953532897345263433]},\"infinity\":{\"data\":0}}}";
//const char inputs_str[] = "[{\"data\":[11280786627794629505,15465988939752547151,1510186046958900449,7392355891667949747]},{\"data\":[0,0,0,0]}]";

int main()
{
    Proof proof;
    VerifyingKey vk;
    PreparedVerifyingKey pvk;
    vector<Scalar> inputs;

    JS::ParseContext parseContext(vk_str);
    parseContext.parseTo(vk);
    
    parseContext = JS::ParseContext(proof_str);
    parseContext.parseTo(proof);
    
    parseContext = JS::ParseContext(inputs_str);
    parseContext.parseTo(inputs);
    
    pvk = prepare_verifying_key(vk);
    
    if(verify_proof(pvk, proof, inputs))
        std::cout << "success!" << std::endl;
    else
        std::cout << "proof invalid" << std::endl;
    
    return 0;
}
